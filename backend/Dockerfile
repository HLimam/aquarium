#
# Build stage
#
FROM maven:3.6.0-jdk-11-slim AS build
COPY src /usr/src/app/api/src
COPY pom.xml /usr/src/app/api
RUN mvn -f /usr/src/app/api/pom.xml clean install -DskipTests

#
# Package stage
#
FROM openjdk:11-slim
WORKDIR /usr/src/app/api
COPY --from=build /usr/src/app/api/target/aquarium-0.0.1-SNAPSHOT.jar /usr/src/app/api/aquarium.jar
ENV SERVER_PORT $SERVER_PORT
ENV HOSTNAME $HOSTNAME
ENV JWT_SECRET $JWT_SECRET
ENV MAIL_USERNAME $MAIL_USERNAME
ENV MAIL_PASSWORD $MAIL_PASSWORD
ENV GITHUB_CLIENT_SECRET $GITHUB_CLIENT_SECRET
ENV GITHUB_CLIENT_ID $GITHUB_CLIENT_ID
ENV DATABASE_PASSWORD $DATABASE_PASSWORD
ENV DATABASE_USER $DATABASE_USER
ENV DATABASE_URL $DATABASE_URL
ENV RECAPTCHA_URL $RECAPTCHA_URL
ENV RECAPTCHA_SECRET $RECAPTCHA_SECRET
EXPOSE 8080
ENTRYPOINT ["java","-jar","aquarium.jar"]